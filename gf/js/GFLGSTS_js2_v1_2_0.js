/** copyright info
 * [GF_logistics]{@link https://github.com/CHANTXU64/Girls-Frontline}
 *
 * @namespace GF_logistics
 * @version 1.2.0
 * @author ChantXu64 [chantxu@outlook.com]
 * @copyright ChantXu64
 * @license MIT
 */
window.ResultsPlan_JS=!0;var Ot=(e(Wt,null,[{key:"clear",value:function(){this._lastResultsPlan=[],this._lastSortBy="Ranking"}},{key:"getLastResultsPlan",value:function(){return this._lastResultsPlan}},{key:"getLastSortBy",value:function(){return this._lastSortBy}},{key:"print",value:function(e,t){var a=0<arguments.length&&void 0!==e?e:this._lastResultsPlan,n=1<arguments.length&&void 0!==t?t:this._lastSortBy;if(document.getElementById("start_ranking_html").style.display="none",0===a.length)document.getElementById("Plan_Table").innerHTML=f.JS.NoPlan,this.clear();else{var i=0,r=document.getElementById("result_plan_table");null!==r&&(i=r.scrollLeft);var l=this.sortResultPlan(a,n);document.getElementById("Plan_Table").innerHTML=this._getPrintHtml(l),0!=i&&(document.getElementById("result_plan_table").scrollLeft=i),this._lastResultsPlan=l,this._lastSortBy=n}}},{key:"sortResultPlan",value:function(e,t){var a=e.slice();switch(t){case"Ranking":h(a,0);break;case"Manp":c(a,5);break;case"Ammu":c(a,6);break;case"Rati":c(a,7);break;case"Part":c(a,8);break;case"TPro":c(a,9);break;case"Equi":c(a,10);break;case"QPro":c(a,11);break;case"QRes":c(a,12)}return a}},{key:"_getPrintHtml",value:function(e){var t="";t+='<div class="table-responsive" id="result_plan_table" style="margin-bottom: 0;">',t+='<table class="table table-striped table-hover text-nowrap result-table" style="margin-bottom: 0; text-align: center; border: 0; font-size: 14px;">';var a=xe();t+=a.printPlanTableTitle()+"<tbody>";var n=60;Z()||(n=a.getTotalTime(!1));for(var i=0;i<e.length;i++){t+="<tr tabindex='0' id='print_result_plan_tr_"+i+"'>";for(var r=0;r<4;r++)t+="<td style='width: 5%;'>",t+=""+e[i][r+1],t+="</td>";for(var l=4;l<8;l++)t+="<td style='width:"+a.PlanTableResourceAndContractWidth+"'>",t+=""+Math.round(e[i][l+1]*n*10)/10,t+="</td>";for(var s=8;s<12;s++)t+="<td style='width:"+a.PlanTableResourceAndContractWidth+";'>",t+=""+Math.round(e[i][s+1]*n*100)/100,t+="</td>";for(var o=e[0].length,d=13;d<o;d++)t+="<td style='width:"+a.PlanTableResourceAndContractWidth+";'>",t+=e[i][d],t+="</td>";t+="</tr>"}return t+="</tbody>"}}]),Wt);function Wt(){u(this,Wt)}Ot._lastResultsPlan=[],Ot._lastSortBy,window.FineTuning_JS=!0;var qt=(e(zt,null,[{key:"clear",value:function(){this._TargetValue_Original=[0,0,0,0,0,0,0,0],this._TargetValue=[0,0,0,0,0,0,0,0],this._ShownTab=-1}},{key:"setFineTuning",value:function(e,t){this._TargetValue_Original=e.slice(),this._TargetValue=e.slice(),this._ShownTab=t}},{key:"getTargetValue",value:function(){return this._TargetValue.slice()}},{key:"getShownTab",value:function(){return this._ShownTab}},{key:"changeTargetValue",value:function(e,t){var a=["MT","AT","RT","PT","TT","ET","QPT","QRT"].indexOf(t);-1===e?this._TargetValue[a]-=this._TargetValue_Original[a]/50:this._TargetValue[a]+=this._TargetValue_Original[a]/50}},{key:"print",value:function(){if(Ue()){var e=document.getElementById("FineTuning"),t=["MT","AT","RT","PT","TT","ET","QPT","QRT"];if(""===e.innerHTML){var a=f.JS,n=[a.FineTuningManp,a.FineTuningAmmu,a.FineTuningRati,a.FineTuningPart,a.FineTuningTPro,a.FineTuningEqui,a.FineTuningQPro,a.FineTuningQRes],i='<div class="card" style="margin-bottom:5px">';i+='<div class="card-header">',i+='<a data-toggle="collapse" id="FineTuningTool_panelTitle" href="#FineTuningTool" class="collapsed">'+a.FineTuningTool+"</a></div>",i+='<div id="FineTuningTool" class="collapse"',x()&&(i+='style="transition: none;"'),i+=">",i+='<div class="card-body row" style="padding: 10px 5px; margin: 0; text-aligh: center;">';for(var r=0;r<8;r++){0===r&&(i+='<div class="col-lg-6 col-md-6 col-sm-6" style="padding-left: 5px; padding-right: 5px;">'),4===r&&(i+='</div> <div class="col-lg-6 col-md-6 col-sm-6" style="padding-left: 5px; padding-right: 5px;">'),i+='<div class="input-group" style="margin-bottom: 10px; width: 100%;">',i+='<span class="input-group-text input-group-span FineTuning-span" style="font-size: 14px;" id="FineTuningTool_'+t[r]+'">'+n[r]+"</span>",i+='<button class="btn btn-outline-dark input-group-btn btn-bolder FineTuning-button" style="display:block;" type="button" id="FineTuning_minus_'+t[r]+'"';var l=this._TargetValue_Original[r],s=this._TargetValue[r];(0===l||s-l/50<=0||s-l/50<.9*l)&&(i+='disabled="disabled"'),i+='title="'+f.HTMLJS.FineTuning_minus+'">-</button>',i+='<button class="btn btn-outline-dark input-group-btn btn-bolder FineTuning-button" style="display: block;" type="button" id="FineTuning_plus_'+t[r]+'"',(0===l||1<=s+l/50||1.14*l<s+l/50)&&(i+='disabled="disabled"'),i+='title="'+f.HTMLJS.FineTuning_plus+'">+</button>',i+="</div>"}i+="</div></div></div></div>",e.innerHTML=i}else for(var o=0;o<8;o++){var d=this._TargetValue_Original[o],u=this._TargetValue[o];if(0===d||u-d/50<=0||u-d/50<.8*d){var _=$("#FineTuning_minus_"+t[o]);"disabled"!==_.attr("disabled")&&_.attr("disabled","disabled")}else{var c=$("#FineTuning_minus_"+t[o]);"disabled"===c.attr("disabled")&&c.removeAttr("disabled")}if(0===d||1<=u+d/50||1.2*d<u+d/50){var m=$("#FineTuning_plus_"+t[o]);"disabled"!==m.attr("disabled")&&m.attr("disabled","disabled")}else{var h=$("#FineTuning_plus_"+t[o]);"disabled"===h.attr("disabled")&&h.removeAttr("disabled")}}}}}]),zt);function zt(){u(this,zt)}qt._TargetValue_Original=[],qt._TargetValue=[],qt._ShownTab=-1;var Ut=(e(jt,[{key:"_setList",value:function(e){for(var t=new Array(e),a=0;a<e;a++)t[a]=new Array(13);return t}},{key:"ranking",value:function(){for(var e=this.ShownTab.getQValidLength(),t=e-3,a=e-2,n=e-1,i=e,r=0;r<t;++r)for(var l=r+1;l<a;++l)for(var s=l+1;s<n;++s)for(var o=s+1;o<i;++o)this._calculateAndPushIntoList(r,l,s,o)}},{key:"_pushIntoList",value:function(e,t,a,n,i,r){0 in this.List[this.List_lastIndex]?this._push(e,t,a,n,i,r):this._pushIntoFirstEmpty(e,t,a,n,i,r)}},{key:"_pushIntoFirstEmpty",value:function(e,t,a,n,i,r){for(var l=this.List_lastIndex;0!==l&&!(0 in this.List[l-1]);)l--;this._pushIntoThisRow(l,e,t,a,n,i,r),this._sortList(l,i)}},{key:"_push",value:function(e,t,a,n,i,r){var l=this.List_lastIndex;i<=this.List[l][12]||(this._pushIntoThisRow(l,e,t,a,n,i,r),this._sortList(l,i))}},{key:"_pushIntoThisRow",value:function(e,t,a,n,i,r,l){this.List[e]=[t,a,n,i,l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],r]}},{key:"_sortList",value:function(e,t){for(var a=e-1;0<=a&&t>this.List[a][12];a--){var n=[this.List[a],this.List[a+1]];this.List[a+1]=n[0],this.List[a]=n[1]}}}]),jt);function jt(e,t){u(this,jt),this.List=this._setList(t),this.List_length=t,this.List_lastIndex=t-1,this.ShownTab=e}var Yt=(t(Xt,Ut),e(Xt,[{key:"_correctTargetValueHTML",value:function(){var e=le(),t=e.slice(0,4),a=e.slice(4,8);return t=this._correctTargetValueHTML_main(t),a=this._correctTargetValueHTML_main(a),se(e=t.concat(a)),e}},{key:"_correctTargetValueHTML_main",value:function(e){for(var t=w(e),a=Math.round(t/5e3*100)/100,n=0;n<4;n++)0!==e[n]&&(e[n]=Math.max(a,e[n]));return e}},{key:"_correctTargetValue",value:function(){var e=this._correctResourceValue(),t=this._correctContractValue(),a=e.concat(t);if(""+a=="0,0,0,0,0,0,0,0")throw E.alert(f.JS.TargetValue0_alert),"Warning: TargetValue cannot all be 0!";return a}},{key:"_correctResourceValue",value:function(){var e=this.targetValue_html.slice(0,4),t=100-de();return this._valuesNotAll0(e)&&this._correctValue(e,t),e}},{key:"_correctContractValue",value:function(){var e=this.targetValue_html.slice(4,8),t=de();return this._valuesNotAll0(e)&&this._correctValue(e,t),e}},{key:"_valuesNotAll0",value:function(e){for(var t=0;t<e.length;t++)if(0!==e[t])return!0;return!1}},{key:"_correctValue",value:function(e,t){for(var a=t/w(e),n=0;n<e.length;n++)e[n]*=a}},{key:"_getNorm",value:function(e){for(var t=0,a=0;a<8;a++)t+=Math.pow(e[a],2);return Math.pow(t,.5)}},{key:"ranking",value:function(){this.ShownTab.deleteUselessMissions(this.QValidMaxLength_1,this.targetValue),o(Xt.prototype.__proto__||Object.getPrototypeOf(Xt.prototype),"ranking",this).call(this),this.ShownTab.getQValidLength()>this.QValidMaxLength_2&&this.ShownTab.deleteUselessMissions(this.QValidMaxLength_2,this.targetValue,this.Qvalid_missionValue)}},{key:"_calculateAndPushIntoList_andCalculateMissionsValue",value:function(e,t,a,n){var i=this.ShownTab.calculateCurrentValue(e,t,a,n);if(-1!==i[0]){var r=this._calculateValue(i),l=this.Qvalid_missionValue;l[e]+=r,l[t]+=r,l[a]+=r,l[n]+=r,this._pushIntoList(e,t,a,n,r,i)}}},{key:"_calculateAndPushIntoList_normal",value:function(e,t,a,n){var i=this.ShownTab.calculateCurrentValue(e,t,a,n);if(-1!==i[0]){var r=this._calculateValue(i);this._pushIntoList(e,t,a,n,r,i)}}},{key:"_calculateValue",value:function(e){var t=this.targetValue,a=[0,0,0,0,0,0,0,0];0!==t[0]&&(a[0]=e[0]),0!==t[1]&&(a[1]=e[1]),0!==t[2]&&(a[2]=e[2]),0!==t[3]&&(a[3]=e[3]),0!==t[4]&&(a[4]=500*e[4]),0!==t[5]&&(a[5]=500*e[5]),0!==t[6]&&(a[6]=500*e[6]),0!==t[7]&&(a[7]=500*e[7]);var n=this._getNorm(a);if(0===n)return 0;var i=this._getDotProduct(a,t)/this._norm_target,r=i/n,l=(-.698131700797732*r*r-.872664625997164)*r+1.57079632679489,s=1-.5*(0<l?l:0);return s*s*i}},{key:"_getDotProduct",value:function(e,t){for(var a=0,n=0;n<8;n++)a+=e[n]*t[n];return a}},{key:"getStdznTargetValue",value:function(e){var t=this._getAvgCurrentByList(),a=t.slice(0,4);a.class="Resource";var n=t.slice(4,8);n.class="Contract";var i=this._getCalibration(a),r=void 0;r="PlanCombination"===e&&0!==i?i*=.8:this._getCalibration(n);for(var l=0;l<4;l++)t[l]=0!==i?this.targetValue_html[l]/i:0;for(var s=4;s<8;s++)t[s]=0!==r?this.targetValue_html[s]/r:0;return t}},{key:"_getAvgCurrentByList",value:function(){var e=[0,0,0,0,0,0,0,0],t=new Array(8),a=this.List;t.fill(this.List_length);for(var n=0;n<8;n++)for(var i=0;i<this.List_length;i++)e[n]+=a[i][n+4],0===a[i][n+4]&&t[n]--;for(var r=0;r<8;r++)0===t[r]?e[r]=0:e[r]/=t[r];return e}},{key:"_getCalibration",value:function(e){for(var t=this._getTarget0Html(e.class),a=this._getCurrent0Max(e.class),n=0,i=e.length,r=0;r<e.length;r++)0!==e[r]?(n+=t[r]/e[r],0===t[r]&&i--):i--;if(0!==n)n/=i;else{for(var l=0,s=e.length,o=0;o<e.length;o++)0!==a[o]?l+=a[o]:s--;0===s?l=0:l/=s,n=w(t)/l}return n}},{key:"_getTarget0Html",value:function(e){return new Array(4),"Resource"===e?this.targetValue_html.slice(0,4):this.targetValue_html.slice(4,8)}},{key:"_getCurrent0Max",value:function(e){return new Array(4),"Resource"===e?this.ShownTab.getCurrentValueMax().slice(0,4):this.ShownTab.getCurrentValueMax().slice(4,8)}}]),Xt);function Xt(e,t,a,n,i){u(this,Xt);var r=d(this,(Xt.__proto__||Object.getPrototypeOf(Xt)).call(this,e,t)),l=r.ShownTab.getQValidLength();if(r.QValidMaxLength_1=Math.min(a,l),r.QValidMaxLength_2=Math.min(n,l),n<l){r._calculateAndPushIntoList=r._calculateAndPushIntoList_andCalculateMissionsValue;var s=new Array(r.QValidMaxLength_1);s.fill(0),r.Qvalid_missionValue=s}else r._calculateAndPushIntoList=r._calculateAndPushIntoList_normal;return i?(r.targetValue_html=i,r.targetValue=i):(r.targetValue_html=r._correctTargetValueHTML(),r.targetValue=r._correctTargetValue()),r._norm_target=r._getNorm(r.targetValue),r}var Zt=(t(Kt,Ut),e(Kt,[{key:"_calculateAndPushIntoList",value:function(e,t,a,n){var i=this.ShownTab.calculateCurrentValue(e,t,a,n);if(-1!==i[0]){for(var r=0;r<8;r++)if(i[r]<this.targetValue_half[r])return;var l=this._calculateValue(i);this._pushIntoList(e,t,a,n,l,i)}}},{key:"_calculateValue",value:function(e){for(var t=0,a=99999999999,n=this.targetValue,i=0;i<8;i++)0!==n[i]&&(a=Math.min(a,e[i]/n[i]));for(var r=0;r<8;r++)t+=this._calculateValue_main(n[r],e[r],a);return t}},{key:"_calculateValue_main",value:function(e,t,a){return 0===e?0:.5*(Math.min(t,e)+Math.min(t,1.5*e*a))}},{key:"getResult",value:function(){for(var e=this.ShownTab,t=e.getQValid(!0),a=e.getCurrentValueMax(),n=[],i=0;i<this.List_length;i++){var r=this.List[i];if(!(0 in r))break;var l=[];l.push(i);for(var s=new Array(4),o=0;o<4;o++)s[o]=t[r[o]][0];s=s.sort(M);for(var d=0;d<4;d++)l.push(s[d]);for(var u=0;u<8;u++)l.push(r[u+4]*a[u]);for(var _=this.ShownTab.printTableCustomize(r[0],r[1],r[2],r[3]),c=0;c<_.length;c++)l.push(_[c]);n.push(l)}return n}},{key:"print",value:function(e){var t=0<arguments.length&&void 0!==e?e:"Ranking";Je(this.getResult(),t)}}]),Kt);function Kt(e,t,a){u(this,Kt);var n=d(this,(Kt.__proto__||Object.getPrototypeOf(Kt)).call(this,e,t));n.targetValue=a,n.targetValue_half=n.targetValue.slice();for(var i=0;i<8;i++)n.targetValue_half[i]=.5*n.targetValue_half[i];return n}var ea=44,ta=34;function aa(){var e=xe();e.setQValid();var t=new Yt(e,8,ea,ta);t.ranking();for(var a=t.getStdznTargetValue(),n=new Array(8),i=e.getCurrentValueMax(),r=0;r<8;r++)n[r]=Math.min(1,a[r]/i[r]),n[r]=Math.max(n[r],0);e.normalizedQValid(),qt.setFineTuning(n,e);var l=new Zt(e,16,n);l.ranking(),l.print(),"none"!==document.getElementById("start_ranking").style.display&&($("#Time_Anytime_hours").attr("disabled","true"),$("#Time_Anytime_minutes").attr("disabled","true"),$("#Tab_Anytime_MinimumIntervalTime_minutes").attr("disabled","true"),$("#Time_Timetable_hours").attr("disabled","true"),$("#Time_Timetable_minutes").attr("disabled","true"),$("#tab_Timetable_deleteall").attr("disabled","true"),$("button[id^=Tab_Timetable_range_thumb_]").attr("disabled","true"),$("#Tab_Timetable_new_hours").attr("disabled","true"),$("#Tab_Timetable_new_minutes").attr("disabled","true"),$("#Tab_Timetable_AddNewTimePoint").attr("disabled","true"),$("#GreatSuccessRate").attr("disabled","true"),$("#GreatSuccessRateUp_btn").attr("disabled","true"),$("#GreatSuccessRateUp_btn").addClass("disabled"),$("#ChapterLimit").attr("disabled","true"),$("#ContractWeight").attr("disabled","true"),$("button[id^=setTarget_]").attr("disabled","true"),$("#MT").attr("disabled","true"),$("#AT").attr("disabled","true"),$("#RT").attr("disabled","true"),$("#PT").attr("disabled","true"),$("#TT").attr("disabled","true"),$("#ET").attr("disabled","true"),$("#QPT").attr("disabled","true"),$("#QRT").attr("disabled","true"),$("button[id^=Target_minus_]").attr("disabled","true"),$("button[id^=Target_plus_]").attr("disabled","true"),document.getElementById("start_ranking").style.display="none",document.getElementById("clear_ranking").style.display="")}function na(e,t){qt.changeTargetValue(e,t);var a=qt.getShownTab(),n=qt.getTargetValue(),i=new Zt(a,16,n);i.ranking(),i.print(Ot.getLastSortBy())}function ia(e,t){var a=new Date(e);a.setDate(a.getDate()+t);var n=a.getMonth()+1;(n+"").length<2&&(n="0"+n);var i=a.getDate();return(i+"").length<2&&(i="0"+i),a.getFullYear()+"-"+n+"-"+i}function ra(e,t){var a=new Date(e);return(new Date(t)-a)/864e5}function la(e){for(var t=e[0],a=0,n=e.length,i=0;i<n;i++)t<e[i]&&(t=e[i],a=i);return a}var sa="GF_Logistics_PC_v"+F.slice(0,F.indexOf("."))+".x.x";function oa(e,t){if(Q){var a=localStorage.getItem(sa);try{a=JSON.parse(a)}catch(e){console.error("storageGetItem, storage: "+a),a={}}null===a&&(a={}),a[e]=t,a.version=F,a=JSON.stringify(a),localStorage.setItem(sa,a)}}function da(e){if(Q){var t=localStorage.getItem(sa);if(null===t)return"noStorage";try{t=JSON.parse(t)}catch(e){console.error("storageGetItem, storage: "+t),t={}}var a=t[e];return void 0===a?"noStorage":a}return"noStorage"}var ua=document.getElementById("PlanCombination_planStartDate"),_a=document.getElementById("PlanCombination_planEndDate"),ca=document.getElementById("PlanCombination_startDate"),ma=document.getElementById("PlanCombination_endDate");function ha(e){var t=0<arguments.length&&void 0!==e&&e,a=ca,n=a.value,i=a.getAttribute("min"),r=a.getAttribute("max");return(""===n||n<i||r<n)&&(n=(new Date).toISOString().slice(0,10),t&&(a.value=n)),n}function va(e){oa("Date",{start:ca.value=e,end:pa()})}function ga(){var e=ca,t=ia(pa(),-1);e.setAttribute("max",t)}function pa(e){var t=0<arguments.length&&void 0!==e&&e,a=ma,n=a.value,i=a.getAttribute("min"),r=a.getAttribute("max");return(""===n||n<i||r<n)&&(n=ia((new Date).toISOString().slice(0,10),7),t&&(a.value=n)),n}function ba(e){ma.value=e,oa("Date",{start:ha(),end:e})}function Ta(){var e=ma,t=ia(ha(),1);e.setAttribute("min",t)}function fa(e){var t=0<arguments.length&&void 0!==e&&e,a=ua,n=a.value,i=ha(),r=ia(pa(),-1);return new Date(n)<new Date(i)||new Date(n)>new Date(r)?(t&&(a.value=""),"error"):n}function ya(){var e=ua,t=ha();e.setAttribute("min",t);var a=void 0,n=Pa();a=ia(""!==n?n:pa(),-1),e.setAttribute("max",a)}function Pa(e){var t=0<arguments.length&&void 0!==e&&e,a=_a,n=a.value,i=ia(ha(),1),r=pa();return new Date(n)<new Date(i)||new Date(n)>new Date(r)?(t&&(a.value=""),"error"):n}function Ca(){var e=_a,t=pa();e.setAttribute("max",t);var a=void 0,n=fa();a=ia(""!==n?n:ha(),1),e.setAttribute("min",a)}function Sa(e){for(var t=0<arguments.length&&void 0!==e?e:["","","","","","","",""],a=["Manp","Ammu","Rati","Part","TPro","Equi","QPro","QRes"],n=0;n<8;++n)$("#Consumption_"+a[n]).val(t[n])}function ka(e){for(var t=0<arguments.length&&void 0!==e&&e,a=["Manp","Ammu","Rati","Part","TPro","Equi","QPro","QRes"],n=[],i=0;i<8;++i)n.push(P($("#PC_demand_"+a[i]),t));return n}function wa(e){for(var t=["Manp","Ammu","Rati","Part","TPro","Equi","QPro","QRes"],a=0;a<8;++a)$("#PC_demand_"+t[a]).val(e[a]);oa("demand",e)}function Aa(e){for(var t=0<arguments.length&&void 0!==e&&e,a=["Manp","Ammu","Rati","Part","TPro","Equi","QPro","QRes"],n=[],i=0;i<8;++i)n.push(P($("#PC_current_"+a[i]),t)),i<4&&3e5<n[i]&&(n[i]=3e5,t&&$("#PC_current_"+a[i]).val(n[i]));return n}function Ma(e){for(var t=["Manp","Ammu","Rati","Part","TPro","Equi","QPro","QRes"],a=0;a<8;++a)$("#PC_current_"+t[a]).val(e[a]);oa("current",e)}function xa(e){for(var t=0<arguments.length&&void 0!==e&&e,a=["Manp","Ammu","Rati","Part","TPro","Equi","QPro","QRes"],n=[],i=0;i<8;++i)n.push(P($("#PC_target_"+a[i]),t)),i<4&&3e5<n[i]&&(n[i]=3e5,t&&$("#PC_target_"+a[i]).val(n[i]));return n}function Da(e){for(var t=["Manp","Ammu","Rati","Part","TPro","Equi","QPro","QRes"],a=0;a<8;++a)$("#PC_target_"+t[a]).val(e[a]);oa("target",e)}function Ia(e){if(""===$("#CommanderLevel").val())return-1;var t=C($("#CommanderLevel"));return t=Math.max(1,t),e&&t!=$("#CommanderLevel").val()&&$("#CommanderLevel").val(t),t}function $a(e){-1===e?$("#CommanderLevel").val(""):$("#CommanderLevel").val(e)}var La=(e(Ra,null,[{key:"add",value:function(){var e=fa(!0),t=Pa(!0);if(""!==e&&""!==t)if("error"!==e&&"error"!==t){var a=this._getATimePeriodHTML(e,t,this._number++);this._timePeriod.push([e,t]),$("#PC_DateTimePeriod_body").append(a)}else E.alert(f.JS.PCTimeAlert2);else E.alert(f.JS.PCTimeAlert1)}},{key:"_getATimePeriodHTML",value:function(e,t,a){var n="";return n+='<code class="list-group-item p-2" id="PC_TimePeriod_'+a+'">',n+=e+" ~ "+t+'<button class="close" title="'+f.JS.delete_+'" id="PC_TimePeriod_close_'+a+'">×</button></code>'}},{key:"deleteThisRow",value:function(e){for(var t=document.getElementById(e),a=0;;){if($("#PC_DateTimePeriod_body").children()[a].id===e){document.getElementById("PC_DateTimePeriod_body").removeChild(t);break}++a}this._timePeriod.splice(a,1)}},{key:"clear",value:function(){var e=this._timePeriod;return this._timePeriod=[],this._number=0,$("#PC_DateTimePeriod_body").html(""),ua.value="",_a.value="",ya(),Ca(),e}},{key:"getTimePeriod",value:function(){for(var e=[],t=this._timePeriod.length,a=0;a<t;++a)e.push(this._timePeriod[a].slice());return e.slice()}},{key:"setTimePeriod",value:function(e){this.clear();for(var t=e.length,a=ha(),n=0;n<t;++n){var i=ia(a,e[n][0]),r=ia(a,e[n][1]);this._timePeriod.push([i,r]);var l=this._getATimePeriodHTML(i,r,this._number++);$("#PC_DateTimePeriod_body").append(l)}}}]),Ra);function Ra(){u(this,Ra)}La._timePeriod=[],La._number=0;var Ea=(e(Va,null,[{key:"init",value:function(e){if(this._table_clear(),"noStorage"!==e&&void 0!==e)this._startDate=e.startDate,this._endDate=e.endDate,this._totalDays=e.totalDays,this._planFlag=e.planFlag,this._plans=e.plans,this._plansNumber=e.plansNumber,0!==this._plans.length&&Xa();else{var t=ha(),a=pa(),n=ra(this._startDate=t,this._endDate=a);0<n&&(this._totalDays=n,this._planFlag=new Array(n),this._planFlag.fill(0)),this._plans=[],this._plansNumber=0}this.setStorage()}},{key:"reset",value:function(){var e=ha(),t=pa();this._startDate=e,this._endDate=t,this._plans=[],this._table_clear(),this._plansNumber=0,this._tableNumber=0;var a=ra(e,t);0<a&&(this._totalDays=a,this._planFlag=new Array(a),this._planFlag.fill(0))}},{key:"setStorage",value:function(){oa("ConsumptionPlan",this.exportData())}},{key:"exportData",value:function(){var e={};return e.startDate=this._startDate,e.endDate=this._endDate,e.totalDays=this._totalDays,e.planFlag=this._planFlag,e.plans=this._plans,e.plansNumber=this._plansNumber,e}},{key:"table_add",value:function(){var e=function(){for(var e=["Manp","Ammu","Rati","Part","TPro","Equi","QPro","QRes"],t=[],a=0;a<8;++a){var n=S($("#Consumption_"+e[a]));t.push(n)}return t}(),t=P($("#Consumption_times")),a=this._table_getHTML(e,t);$("#Consumption_tbody").append(a);for(var n=this._tableData,i=0;i<8;++i)n[0][i]+=e[i]*t;e.push(t),n.push(e),this._table_printTotal(this._tableData[0])}},{key:"_table_getHTML",value:function(e,t){for(var a=this._tableNumber++,n='<tr id="Consumption_table_row_'+a+'">',i=0;i<8;++i)n+="<td>",0<e[i]&&(n+="+"),n+=b(e[i])+"</td>";return n+="<td>"+t,n+='<button id="Consumption_table_close_row_'+a+'" class="close" title="'+f.JS.delete_+'">×</button></td>'}},{key:"_table_deleteThisRow",value:function(e){for(var t=document.getElementById(e),a=0;;){if($("#Consumption_tbody").children()[a].id===e){document.getElementById("Consumption_tbody").removeChild(t);break}++a}for(var n=this._tableData[a+1],i=0;i<8;++i){var r=n[8];this._tableData[0][i]-=n[i]*r}this._table_printTotal(this._tableData[0]),this._tableData.splice(a+1,1)}},{key:"_table_clear",value:function(){this._tableData=[[0,0,0,0,0,0,0,0]],this._tableNumber=0,document.getElementById("Consumption_tbody").innerHTML="",this._table_printTotal(this._tableData[0])}},{key:"_table_printTotal",value:function(e){for(var t="<tr>",a=0;a<8;++a)t+="<td>",0<e[a]&&(t+="+"),t+=b(e[a])+"</td>";t+="</tr>",document.getElementById("Consumption_total").innerHTML=t}},{key:"add",value:function(){var e=La.getTimePeriod(),t=e.length;if(0!==t)if(32<=this._plans.length)E.alert(f.JS.PC_L_alert3);else{for(var a=this._planFlag.slice(),n=0;n<t;++n){e[n][0]=ra(this._startDate,e[n][0]),e[n][1]=ra(this._startDate,e[n][1]);for(var i=e[n][0],r=e[n][1],l=i;l<r;++l)if(++this._planFlag[l],1<this._planFlag[l]){this._planFlag=a;var s=ia(this._startDate,l);return void E.alert(f.JS.PC_C_alert2_1+s+f.JS.PC_C_alert2_2)}}for(var o=[240],d=0;d<t;++d)o.push(e[d][0]),o.push(1680),o.push(e[d][1]-e[d][0]);var u={};u.timePeriod=e,u.number=this._plansNumber++,u.reAndco=this._tableData[0].slice(),u.TimetableData=o;for(var _=[],c=0;c<this._tableData.length;++c)_.push(this._tableData[c].slice());u.tableData=_.slice(),this._plans.push(u),La.clear(),Xa(),this._plansHasChanged()}else E.alert(f.JS.PC_L_alert1)}},{key:"apply",value:function(e){document.getElementById("LogisticsConsumptionPlanSwitch").checked=!0,Ka(),this._table_clear();for(var t=0;this._plans[t].number!==e;)++t;La.setTimePeriod(this._plans[t].timePeriod);var a=[];void 0===this._plans[t].tableData?(a.push(this._plans[t].reAndco.slice()),a.push(this._plans[t].reAndco.slice()),a[1].push(1)):a=this._plans[t].tableData;for(var n=1;n<a.length;++n){var i=a[n],r=this._table_getHTML([i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7]],i[8]);$("#Consumption_tbody").append(r)}this._table_printTotal(this._plans[t].reAndco),this._tableData=[];for(var l=0;l<a.length;++l)this._tableData.push(a[l].slice())}},{key:"deleteAll",value:function(){this.reset(),Za(),this._plansHasChanged()}},{key:"deleteThis",value:function(e){for(var t=0;this._plans[t].number!==e;)++t;for(var a=this._plans[t].timePeriod.length,n=0;n<a;++n)for(var i=this._plans[t].timePeriod[n][0],r=this._plans[t].timePeriod[n][1],l=i;l<r;++l)this._planFlag[l]=0;this._plans.splice(t,1),this._plansHasChanged(),0===this._plans.length&&0===Fa._plans.length&&Za()}},{key:"_plansHasChanged",value:function(){Ba.printFromConsumptionPlan(this._plans),this.setStorage()}},{key:"chartGetPlans",value:function(){return this._plans}}]),Va);function Va(){u(this,Va)}Ea._plans=[],Ea._plansNumber=0,Ea._startDate="",Ea._endDate="",Ea._totalDays=0,Ea._planFlag=[],Ea._tableNumber=0,Ea._tableData=[[0,0,0,0,0,0,0,0]];var Fa=(e(Qa,null,[{key:"init",value:function(e){if("noStorage"!==e&&void 0!==e)this._startDate=e.startDate,this._endDate=e.endDate,this._totalDays=e.totalDays,this._totalTimePerDay=e.totalTimePerDay,this._plans=e.plans,this._plansNumber=e.plansNumber,0!==this._plans.length&&Xa();else{var t=ha(),a=pa(),n=ra(this._startDate=t,this._endDate=a);0<n&&(this._totalDays=n,this._totalTimePerDay=new Array(n),this._totalTimePerDay.fill(0)),this._plans=[],this._plansNumber=0}this.setStorage()}},{key:"reset",value:function(){var e=ha(),t=pa();this._startDate=e,this._endDate=t,this._plans=[],this._plansNumber=0;var a=ra(e,t);0<a&&(this._totalDays=a,this._totalTimePerDay=new Array(a),this._totalTimePerDay.fill(0)),this.setStorage()}},{key:"setStorage",value:function(){oa("LogisticsPlan",this.exportData())}},{key:"exportData",value:function(){var e={};return e.startDate=this._startDate,e.endDate=this._endDate,e.totalDays=this._totalDays,e.totalTimePerDay=this._totalTimePerDay,e.plans=this._plans,e.plansNumber=this._plansNumber,e}},{key:"add",value:function(){var e=La.getTimePeriod(),t=e.length;if(0!==t)if(32<=this._plans.length)E.alert(f.JS.PC_L_alert3);else{for(var a="",n=0;n<t;++n)a+=e[n][0].slice(5)+"~"+e[n][1].slice(5)+", ",e[n][0]=ra(this._startDate,e[n][0]),e[n][1]=ra(this._startDate,e[n][1]);a=a.slice(0,-2);for(var i=xe().getTotalTime(),r=this._totalTimePerDay.slice(),l=0;l<t;++l)for(var s=e[l][0],o=e[l][1],d=s;d<o;++d)if(this._totalTimePerDay[d]+=i,1440<this._totalTimePerDay[d]){this._totalTimePerDay=r;var u=ia(this._startDate,d);return void E.alert(f.JS.PC_L_alert2_1+u+f.JS.PC_L_alert2_2)}var _=at.getSavedDataFromPage(a),c={};c.timePeriod=e,c.saved=_,c.time=i,c.number=this._plansNumber++,c.reAndco=at.getReAndCoBySaved(c.saved,!1),this._plans.push(c),La.clear(),Xa(),this._plansHasChanged()}else E.alert(f.JS.PC_L_alert1)}},{key:"apply",value:function(e){document.getElementById("LogisticsConsumptionPlanSwitch").checked=!1,en();for(var t=0;this._plans[t].number!==e;)++t;at.apply(this._plans[t].saved),La.setTimePeriod(this._plans[t].timePeriod)}},{key:"deleteAll",value:function(){this.reset(),Za(),this._plansHasChanged()}},{key:"deleteThis",value:function(e){for(var t=0;this._plans[t].number!==e;)++t;for(var a=this._plans[t].time,n=this._plans[t].timePeriod.length,i=0;i<n;++i)for(var r=this._plans[t].timePeriod[i][0],l=this._plans[t].timePeriod[i][1],s=r;s<l;++s)this._totalTimePerDay[s]-=a;this._plans.splice(t,1),this._plansHasChanged(),0===this._plans.length&&0===Ea._plans.length&&Za()}},{key:"_plansHasChanged",value:function(){Ba.printFromLogisticsPlan(this._plans),this.setStorage()}},{key:"chartGetPlans",value:function(){return this._plans}},{key:"rankingGetPlans",value:function(){return this._plans}}]),Qa);function Qa(){u(this,Qa)}Fa._plans=[],Fa._plansNumber=0,Fa._startDate="",Fa._endDate="",Fa._totalDays=0,Fa._totalTimePerDay=[];var Ba=(e(Na,null,[{key:"resize_Timetable",value:function(){var e=document.getElementById("PlanCombination_chart");null!==e.getAttribute("_echarts_instance_")&&document.getElementById("PlanCombinationSwitch").checked&&""!==e.getAttribute("_echarts_instance_")&&echarts.getInstanceByDom(e).resize()}},{key:"printFromLogisticsPlan",value:function(e){var t=Ea.chartGetPlans();this.print(e,t)}},{key:"printFromConsumptionPlan",value:function(e){var t=Fa.chartGetPlans();this.print(t,e)}},{key:"print",value:function(e,t){var a=void 0;a=void 0===e?0:e.length;var n=void 0;n=void 0===t?0:t.length,0===a&&0===n?this._print_main():0===a&&0!==n?this._print_main(void 0,t):0!==a&&0===n?this._print_main(e):0!==a&&0!==n&&this._print_main(e,t)}},{key:"_print_main",value:function(e,t){var a=0<arguments.length&&void 0!==e?e:[{timePeriod:[0,0],time:0,number:-1,reAndco:[]}],n=1<arguments.length&&void 0!==t?t:[{timePeriod:[0,0],TimetableData:[0],number:-1,reAndco:[]}],i=document.getElementById("PlanCombination_chart"),r=void 0;null===i.getAttribute("_echarts_instance_")||""===i.getAttribute("_echarts_instance_")?r=echarts.init(i):((r=echarts.getInstanceByDom(i)).off("click"),r.clear());var l=ha(),s=pa(),o=ra(l,s);this._LogisticsTimetableOriginalData=a,this._ConsumptionTimetableOriginalData=n,this._LogisticsTimetableData=this._LogisticsPlanDataToTimetableData(a,o),this._ConsumptionTimetableData=this._ConsumptionPlanDataToTimetableData(n,o);var d=Aa(!0);this._reAndcoData=this._calcReAndCoData(d,a,n,o),this._reAndcoData=this._resourceRegen(o),this._reAndcoData=this._reAndcoDataToChartData(o);var u=function(n,e){for(var t=ra(n,e),i=new Array(t+1),a=0;a<t+1;++a)i[a]=ia(n,a);var r=n.slice(0,4)===e.slice(0,4),l=(f.JS,!1),s=Ia(),o=an(s),d=void 0;return d=-1!==s?[{yAxis:0},{yAxis:o},{yAxis:3e5}]:[{yAxis:0},{yAxis:3e5}],x()||(l=!0),{grid:[{left:60,right:45,top:50,height:125,tooltip:{trigger:"axis",axisPointer:{type:"line"}}},{left:60,right:45,bottom:55,height:70,tooltip:{type:"item"}}],tooltip:{trigger:"item",backgroundColor:"rgba(245, 245, 245, 0.8)",borderWidth:1,borderColor:"#ccc",padding:10,textStyle:{color:"#000"},position:function(e,t,a,n,i){var r={top:10};return r[["left","right"][+(e[0]<i.viewSize[0]/2)]]=30,r},formatter:function(e){var t="";t+=i[e[0].axisValue]+"<br>";for(var a=0;a<e.length;++a)t+=e[a].marker+e[a].seriesName+": ",t+=e[a].data[1]+"<br>";return t},extraCssText:"width: 170px"},toolbox:{right:30,feature:{saveAsImage:{name:"GF",title:" "}}},dataZoom:[{type:"inside",xAxisIndex:[0,1],minValueSpan:7,filterMode:"none"},{show:!0,xAxisIndex:[0,1],type:"slider",showDataShadow:!1,bottom:9,height:10,filterMode:"none",borderColor:"transparent",backgroundColor:"#e2e2e2",handleIcon:"M10.7,11.9H9.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4h1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7v-1.2h6.6z M13.3,22H6.7v-1.2h6.6z M13.3,19.6H6.7v-1.2h6.6z",handleSize:16,handleStyle:{shadowBlur:6,shadowOffsetX:1,shadowOffsetY:2,shadowColor:"#aaa"},minValueSpan:7,labelFormatter:""}],legend:{left:0},xAxis:[{type:"value",min:0,max:t,axisTick:{show:!1},scale:!0,axisLabel:{show:!1},boundaryGap:!1,gridIndex:0,axisLine:{onZero:!1}},{type:"value",min:0,scale:!0,minInterval:1,axisLabel:{formatter:function(e){var t=ia(n,e),a=t.slice(5);return r?a:a+"\n"+t.slice(0,4)}},max:t,gridIndex:1}],yAxis:[{name:f.JS.resource,nameGap:9,type:"value",scale:!0,gridIndex:0,splitLine:{show:!1},minInterval:1},{name:f.JS.contract,nameGap:9,type:"value",scale:!0,gridIndex:0,splitLine:{show:!1},minInterval:1},{max:1680,interval:1440,axisLine:{show:!0,step:1440},axisLabel:{show:!1},axisTick:{show:!1,alignWithLabel:!0},gridIndex:1}],series:[{name:f.JS.Manp,data:Ba._reAndcoData[0],type:"line",xAxisIndex:0,yAxisIndex:0,markLine:{silent:!0,label:{show:!1},data:d,symbol:"none",precision:0}},{name:f.JS.Ammu,data:Ba._reAndcoData[1],type:"line",xAxisIndex:0,yAxisIndex:0,markLine:{silent:!0,label:{show:!1},data:d,symbol:"none",precision:0}},{name:f.JS.Rati,data:Ba._reAndcoData[2],type:"line",xAxisIndex:0,yAxisIndex:0,markLine:{silent:!0,label:{show:!1},data:d,symbol:"none",precision:0}},{name:f.JS.Part,data:Ba._reAndcoData[3],type:"line",xAxisIndex:0,yAxisIndex:0,markLine:{silent:!0,label:{show:!1},data:d,symbol:"none",precision:0}},{name:f.JS.TPro,data:Ba._reAndcoData[4],type:"line",xAxisIndex:0,yAxisIndex:1,markLine:{silent:!0,label:{show:!1},data:{yAxis:0},symbol:"none",precision:0}},{name:f.JS.Equi,data:Ba._reAndcoData[5],type:"line",xAxisIndex:0,yAxisIndex:1,markLine:{silent:!0,label:{show:!1},data:{yAxis:0},symbol:"none",precision:0}},{name:f.JS.QPro,data:Ba._reAndcoData[6],type:"line",xAxisIndex:0,yAxisIndex:1,markLine:{silent:!0,label:{show:!1},data:{yAxis:0},symbol:"none",precision:0}},{name:f.JS.QRes,data:Ba._reAndcoData[7],type:"line",xAxisIndex:0,yAxisIndex:1,markLine:{silent:!0,label:{show:!1},data:{yAxis:0},symbol:"none",precision:0}},{type:"custom",renderItem:Ha,encode:{x:[0,1],y:2,itemName:3},data:Ba._LogisticsTimetableData,clip:!0,xAxisIndex:1,yAxisIndex:2,tooltip:{formatter:function(e){var t=e.dataIndex,a=f.JS.chartTooltip_L,n=Ba._LogisticsTimetableOriginalData[t].saved.Missions,i=["#A1C0FF","#FF8C8A","#75d874","#FFDA93"],r=a+"<br>";r+=f.JS.Mission+": <br>";for(var l=0;l<n.length;++l)r+="<span style='display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:"+i[l]+";'></span>",r+=n[l]+"<br>";return r}},emphasis:{itemStyle:{borderColor:"#000",borderWidth:1,borderType:"solid"}}},{type:"custom",renderItem:Ga,data:Ba._ConsumptionTimetableData,clip:!0,xAxisIndex:1,yAxisIndex:2,tooltip:{formatter:function(e){for(var t=e.dataIndex,a=f.JS.chartTooltip_C,n=Ba._ConsumptionTimetableOriginalData[t].reAndco,i=a+"<br>",r=["#c23531","#2f4554","#61a0a8","#d48265","#91c7ae","#749f83","#ca8622","#bda29a"],l=["Manp","Ammu","Rati","Part","TPro","Equi","QPro","QRes"],s=0;s<8;++s)i+="<span style='display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:"+r[s]+";'></span>",i+=f.JS[l[s]],i+=": ",0<n[s]&&(i+="+"),i+=b(n[s])+"<br>";return i}},emphasis:{itemStyle:{borderColor:"#000",borderWidth:1,borderType:"solid"}}}],animation:l}}(l,s);r.setOption(u),r.on("click",{seriesIndex:8},function(e){Ja(e)}),r.on("click",{seriesIndex:9},function(e){Ja(e)}),$("#PC_deletePlan").off(),$("#PC_deletePlan").attr("disabled","true")}},{key:"_LogisticsPlanDataToTimetableData",value:function(e,t){var a=[],n=new Array(t);n.fill(0);for(var i=e.length,r=0;r<i;++r){var l={};l.name=e[r].number;var s=e[r],o=s.time;l.value=[o];for(var d=s.timePeriod.length,u=0;u<d;++u)for(var _=s.timePeriod[u][0],c=s.timePeriod[u][1],m=-1,h=_;h<c;++h){n[h]+=o;var v=n[h],g=l.value;if(v===m)g[g.length-1]++;else{var p=h;g.push(p),g.push(v),g.push(1),m=n[h]}}l.itemStyle={},l.itemStyle.color=this.colorList[r],a.push(l)}return a}},{key:"_ConsumptionPlanDataToTimetableData",value:function(e){for(var t=[],a=e.length,n=0;n<a;++n){var i={};i.name=e[n].number,i.value=e[n].TimetableData,i.itemStyle={},i.itemStyle.color=this.colorList[32+n],t.push(i)}return t}},{key:"_calcReAndCoData",value:function(e,t,a,n){for(var i=[],r=0;r<8;++r){var l=new Array(n);l.fill(0),l[0]=e[r];for(var s=t.length,o=0;o<s;++o)for(var d=t[o].reAndco[r],u=t[o].timePeriod.length,_=0;_<u;++_)for(var c=t[o].timePeriod[_][0],m=t[o].timePeriod[_][1],h=c;h<m;++h)l[h]+=d;for(var v=a.length,g=0;g<v;++g)for(var p=a[g].reAndco[r],b=a[g].timePeriod.length,T=0;T<b;++T)for(var f=a[g].timePeriod[T][0],y=a[g].timePeriod[T][1],P=f;P<y;++P)l[P]+=p;l[0]=r<4?Math.min(Math.round(l[0]),3e5):Math.round(l[0]);for(var C=1;C<n;++C){var S=Math.round(l[C]+l[C-1]);l[C]=!(r<4)||S<3e5?S:3e5}l.unshift(Math.round(e[r])),i.push(l)}return i}},{key:"_resourceRegen",value:function(e){var t=Ia(!0);if(-1===t)return this._reAndcoData;for(var a=an(t),n=[1440,1440,1440,480],i=0;i<4;++i)for(var r=this._reAndcoData[i],l=0,s=1;s<=e;++s)if(r[s]+l<a){var o=l+n[i];r[s]+o>a&&(o=a-r[s]),r[s]+=o,l=o}else r[s]+=l;return this._reAndcoData}},{key:"_reAndcoDataToChartData",value:function(e){for(var t=[],a=0;a<8;++a){for(var n=[],i=this._reAndcoData[a],r=0;r<=e;++r)n.push([r,i[r]]);t.push(n)}return t}}]),Na);function Na(){u(this,Na)}function Ha(e,t){for(var a=t.style(),n=[],i=t.value(0),r=e.dataIndex,l=Ba._LogisticsTimetableData[r].value,s=0;!isNaN(l[3*s+1]);){var o=t.coord([l[3*s+1],l[3*s+2]]),d=t.size([l[3*s+3],i]),u={type:"rect",shape:{}};u.shape.x=o[0],u.shape.y=o[1],u.shape.width=d[0],u.shape.height=d[1],u.style=a,n.push(u),++s}return{type:"group",children:n}}function Ga(e,t){for(var a=t.style(),n=[],i=t.value(0),r=e.dataIndex,l=Ba._ConsumptionTimetableData[r].value,s=0;!isNaN(l[3*s+1]);){var o=t.coord([l[3*s+1],l[3*s+2]]),d=t.size([l[3*s+3],i]),u={type:"rect",shape:{}};u.shape.x=o[0],u.shape.y=o[1],u.shape.width=d[0],u.shape.height=d[1],u.style=a,n.push(u),++s}return{type:"group",children:n}}function Ja(e){var t=e.seriesIndex,a=e.data.name;8===t?Fa.apply(a):Ea.apply(a),$("#PC_deletePlan").removeAttr("disabled"),$("#PC_deletePlan").off(),$("#PC_deletePlan").on("click",function(){8===t?Fa.deleteThis(a):Ea.deleteThis(a),$("#PC_deletePlan").attr("disabled","true")}),8===t&&at.cancelSelected();var n=document.getElementById("PlanCombination_chart");if(null!==n.getAttribute("_echarts_instance_")&&""!==n.getAttribute("_echarts_instance_")){var i=echarts.getInstanceByDom(n);i.dispatchAction({type:"downplay",seriesIndex:[8,9]}),i.dispatchAction({type:"highlight",seriesIndex:t,dataIndex:e.dataIndex})}}Ba.colorList=["#da0d68","#975e6d","#fde404","#0aa3b5","#9db2b7","#e0719c","#f99e1c","#4eb849","#ef5a78","#f7f1bd","#dd4c51","#3e0317","#6569b0","#c94a44","#f2684b","#aeb92c","#f68a5c","#baa635","#f7a128","#e2631e","#7eb138","#e1c315","#9ea718","#94a76f","#d0b24f","#b09733","#8f1c53","#b34039","#ba9232","#8b6439","#187a2f","#62aa3c","#038549","#28b44b","#7ac141","#5e9a80","#8b8c90","#beb276","#744e03","#a3a36f","#c9b583","#978847","#9d977f","#cc7b6a","#db646a","#76c0cb","#80a89d","#def2fd","#7a9bae","#039fb8","#5e777b","#caa465","#dfbd7e","#be8663","#899893","#a1743b","#894810","#c78936","#8c292c","#e5762e","#c78869","#d4ad12","#692a19"];var Oa=void 0;var Wa=(e(qa,[{key:"ranking",value:function(e){var t=0<arguments.length&&void 0!==e?e:0;if(0===t&&(this._planValue_total=0,E.progress(),this._noPlan=0),t<this.allPlan.length){var a=t,n=this.allPlan[a],i=this.original_demandValue;n.ranking(i),this._planValue_total+=n.planValue}if(t!==this.allPlan.length-1||(this.sortPlanByPlanValue(),0!==this._planValue_total)){if(t===this.allPlan.length&&(this._demandValue=this.original_demandValue.slice(),this._reAndcoValue_Norm_sum=[0,0,0,0,0,0,0,0],this._reAndcoValue_sum=[0,0,0,0,0,0,0,0],this._planValue_sum=0),t===2*this.allPlan.length){this._demandValue_0=this.original_demandValue.slice();for(var r=this._demandValue_0,l=0,s=0;s<8;++s){var o=la(this._reAndcoValue_Norm_sum);if(0!==r[o]){l=this._reAndcoValue_sum[o]/r[o];break}this._reAndcoValue_Norm_sum[o]=0}0===l&&(this._demandValue_0=this.original_demandValue.slice());for(var d=0;d<8;++d)0!==r[d]&&0!==this._reAndcoValue_sum[d]&&(r[d]=((r[d]*l-this._reAndcoValue_sum[d])/this._reAndcoValue_sum[d]*.9+1)*r[d]);this._demandValue=this.original_demandValue.slice(),this._reAndcoValue_Norm_sum=[0,0,0,0,0,0,0,0],this._reAndcoValue_sum=[0,0,0,0,0,0,0,0],this._planValue_total=this._planValue_sum,this._planValue_sum=0}if(t>=this.allPlan.length&&t<3*this.allPlan.length){var u=t%this.allPlan.length,_=this.allPlan[u];if(this._planValue_sum+=_.planValue,t===2*this.allPlan.length?_.ranking(this._demandValue_0):_.ranking(this._demandValue),0!==_.planValue){for(var c=0;c<8;++c)this._reAndcoValue_Norm_sum[c]+=_.reAndcoValue_Norm[c],this._reAndcoValue_sum[c]+=_.reAndcoValue[c]*_.days;for(var m=this._planValue_sum/this._planValue_total,h=la(this._reAndcoValue_Norm_sum),v=this._reAndcoValue_sum[h]/m,g=0;g<8;++g)this._demandValue[g]=this.original_demandValue[g]*v,this._demandValue[g]-=this._reAndcoValue_sum[g],this._demandValue[g]<0&&(this._demandValue[g]=0)}else t>=2*this.allPlan.length&&t<3*this.allPlan.length&&this._noPlan++}var p=100*(t+1)/this.allPlan.length/3+"%";if(E.progress_setWidth(p),t===3*this.allPlan.length-1){for(var b=0;b<this.plans_number;++b)this.allPlan[b].applyToLogisticsPlanData();Fa._plansHasChanged();var T=f.JS.PC_ranking_done;0!==this._noPlan&&(T+=f.JS.PC_ranking_alert3_1+this._noPlan+f.JS.PC_ranking_alert3_2),E.alert(T),E.progress_close()}else setTimeout(function(){Oa.ranking(++t)},1)}else E.alert(f.JS.PC_ranking_alert2)}},{key:"sortPlanByPlanValue",value:function(){this.allPlan.sort(za)}}]),qa);function qa(e,t){u(this,qa),this.original_demandValue=t,this.allPlan=[];var a=e.length;this.plans_number=a;for(var n=[0,0,0,0,0,0,0,0],i=0;i<a;++i){this.allPlan.push(new Ua(e[i],t));for(var r=this.allPlan[i].reAndcoValue_Max,l=0;l<8;++l)n[l]=Math.max(n[l],r[l])}this.reAndcoValue_MaxMax=n;for(var s=0;s<a;++s)this.allPlan[s].resetReAndCoValueMax(this.reAndcoValue_MaxMax.slice())}function za(e,t){return t.planValue-e.planValue}var Ua=(e(ja,[{key:"calcDays",value:function(){for(var e=this.LogisticsPlanData.timePeriod,t=0,a=0;a<e.length;++a)t=t+e[a][1]-e[a][0];return t}},{key:"resetReAndCoValueMax",value:function(e){this.reAndcoValue_Max=e}},{key:"ranking",value:function(e){var t=at.creatTabBySaved(this.LogisticsPlanData.saved);t.setQValid();var a=new Yt(t,8,48,38,e);a.ranking();for(var n=a.getStdznTargetValue("PlanCombination"),i=new Array(8),r=t.getCurrentValueMax(),l=0;l<8;l++)i[l]=Math.min(1,n[l]/r[l]),i[l]=Math.max(i[l],0);t.normalizedQValid();var s=new Zt(t,3,i);s.ranking();var o=s.getResult(),d=[];if(0!==o.length){for(var u=this.totalTime,_=0;_<8;++_)d.push(o[0][_+5]*u);this.missions=o[0].slice(1,5)}else d=[0,0,0,0,0,0,0,0],this.missions=[];this.reAndcoValue=d,this.reAndcoValue_Norm=this.normReAndCo(this.reAndcoValue),this.planValue=this.calcPlanValue(this.reAndcoValue_Norm)}},{key:"normReAndCo",value:function(e){for(var t=this.reAndcoValue_Max,a=[],n=this.days,i=0;i<8;++i)a.push(n*e[i]/t[i]);return a}},{key:"calcPlanValue",value:function(e){for(var t=0,a=0;a<8;++a)t+=e[a];return t}},{key:"applyToLogisticsPlanData",value:function(){this.LogisticsPlanData.saved.Missions=this.missions,this.LogisticsPlanData.reAndco=this.reAndcoValue}}]),ja);function ja(e,t){u(this,ja),this.LogisticsPlanData=e;var a=at.creatTabBySaved(e.saved);this.totalTime=a.getTotalTime(),a.setQValid(),this.reAndcoValue_Max=a.getCurrentValueMax(),this.original_demandValue=t,this.days=this.calcDays()}function Ya(){document.getElementById("PlanCombinationSwitch").checked?(fe(),at.cancelSelected(),tt(),et(),$("#plan_combination_card").removeClass("d-none"),$("#PlanCombination_addTimePeriod").removeClass("d-none"),$("#PC_addLogisticsPlan").removeClass("d-none"),$("#target").addClass("d-none"),$("#start_ranking").addClass("d-none"),$("#result_card").addClass("d-none"),$("#Logistics_setting_title").removeClass("d-none")):(en(),$("#plan_combination_card").addClass("d-none"),$("#PlanCombination_addTimePeriod").addClass("d-none"),$("#PC_addLogisticsPlan").addClass("d-none"),$("#PC_addConsumptionPlan").addClass("d-none"),$("#target").removeClass("d-none"),$("#start_ranking").removeClass("d-none"),$("#result_card").removeClass("d-none"),$("#Logistics_setting_title").addClass("d-none")),Ba.resize_Timetable()}function Xa(){$("#PlanCombination_startDate").attr("disabled","true"),$("#PlanCombination_endDate").attr("disabled","true")}function Za(){$("#PlanCombination_startDate").removeAttr("disabled"),$("#PlanCombination_endDate").removeAttr("disabled")}function Ka(){document.getElementById("LogisticsConsumptionPlanSwitch").checked=!0,$("#ConsumptionPlan_setting").removeClass("d-none"),$("#PC_addLogisticsPlan").addClass("d-none"),$("#PC_addConsumptionPlan").removeClass("d-none"),$("#plan_setting").addClass("d-none")}function en(){document.getElementById("LogisticsConsumptionPlanSwitch").checked=!1,$("#ConsumptionPlan_setting").addClass("d-none"),$("#PC_addLogisticsPlan").removeClass("d-none"),$("#PC_addConsumptionPlan").addClass("d-none"),$("#plan_setting").removeClass("d-none")}var tn=[0,3e3,3200,3400,3600,3800,4e3,4200,4500,4700,5e3,5200,5500,5700,6e3,6300,6600,6900,7200,7500,7800,8100,8400,8700,9100,9400,9700,10100,10400,10800,11200,11500,11900,12300,12700,13100,13500,13900,14300,14700,15100,15500,16e3,16400,16900,17300,17800,18200,18700,19200,19600,20100,20600,21100,21600,22100,22600,23100,23600,24200,24700,25200,25800,26300,26900,27400,28e3,28600,29100,29700,30300,30900,31500,32100,32700,33300,33900,34600,35200,35800,36500,37100,37800,38400,39100,39700,40400,41100,41800,42500,43200,43900,44600,45300,46e3,46700,47400,48200,48900,49600,50400,51100,51900,52600,53400,54200,55e3,55700,56500,57300,58100,58900,59700,60600,61400,62200,63e3,63900,64700,65500,66400,67300,68100,69e3,69800,70700,71600,72500,73400,74300,75200,76100,77e3,77900,78800,79800,80700,81600,82600,83500,84500,85400,86400,87400,88400,89300,90300,91300,92300,93300,94300,95300,96300,97400,98400,99400,1e5];function an(e){return 156<e?1e5+200*(e-156):tn[e]}function nn(e){if("LocalStorage"===e){var t=da("Date");"noStorage"===t?(va((new Date).toISOString().slice(0,10)),ba(ia((new Date).toISOString().slice(0,10),7))):(va(t.start),ba(t.end));var a=da("current");"noStorage"!==a&&Ma(a);var n=da("target");"noStorage"!==n&&Da(n);var i=da("demand");"noStorage"!==i&&wa(i);var r=da("level");"noStorage"!==r&&$a(r),Fa.init(da("LogisticsPlan")),Ea.init(da("ConsumptionPlan"))}else{var l=e.date;va(l.start),ba(l.end),Ma(e.current),Da(e.target),wa(e.demand),$a(e.level),Fa.init(e.LogisticsData),Ea.init(e.ConsumptionData)}ga(),Ta(),ya(),Ca(),Ba.print(Fa.chartGetPlans(),Ea.chartGetPlans())}$("#PlanCombinationSwitch").on("click",function(){Ya()});var rn=$("#PlanCombination_startDate");rn.on("input propertychange",function(){Ta(),ya(),Ca(),La.clear()}),rn.on("blur",function(){oa("Date",{start:ha(!0),end:pa()}),Fa.reset(),Ea.reset(),Ba.print()});var ln=$("#PlanCombination_endDate");function sn(){window.sha1&&window.md5&&window.LZString&&window.echarts&&window.ES6Promise&&window.html2canvas?($("#Config_importInput").removeAttr("disabled"),$("#Config_importButton").removeAttr("disabled"),$("#Config_export").removeAttr("disabled"),$("#importSaved_input").removeAttr("disabled"),$("#importSaved_importButton").removeAttr("disabled"),$("#Capture").removeAttr("disabled"),$("#page_loading").remove(),$("#PlanCombinationSwitch").removeAttr("disabled"),nn("LocalStorage"),Le=!0):setTimeout(sn,100)}function loadBackupJS(){if(!window.sha1){var e=document.createElement("script");e.src="./dependent/js/sha1.min.js",document.body.appendChild(e)}if(!window.md5){var t=document.createElement("script");t.src="./dependent/js/md5.min.js",document.body.appendChild(t)}if(!window.LZString){var a=document.createElement("script");a.src="./dependent/js/lz-string.min.js",document.body.appendChild(a)}if(!window.echarts){var n=document.createElement("script");n.src="./dependent/js/echarts.min.js",document.body.appendChild(n)}if(!window.ES6Promise){var i=document.createElement("script");i.src="./dependent/js/es6_promise.auto.min.js",document.body.appendChild(i)}if(!window.html2canvas){var r=document.createElement("script");r.src="./dependent/js/html2canvas.min.js",document.body.appendChild(r)}}ln.on("input propertychange",function(){ga(),ya(),Ca(),La.clear()}),ln.on("blur",function(){var e=pa(!0);oa("Date",{start:ha(),end:e}),Fa.reset(),Ea.reset(),Ba.print()}),$("#CommanderLevel").on("blur",function(){oa("level",Ia()),Ba.print(Fa.chartGetPlans(),Ea.chartGetPlans())}),$("#PlanCombination_planStartDate").on("blur",function(){fa(!0),Ca()}),$("#PlanCombination_planEndDate").on("blur",function(){Pa(!0),ya()}),$("#PC_deleteAllPlans").on("click",function(){E.confirm(f.JS.PC_deleteAll_confirm,function(){Fa.deleteAll(),Ea.deleteAll()})}),$("#LogisticsConsumptionPlanSwitch").on("click",function(){(document.getElementById("LogisticsConsumptionPlanSwitch").checked?Ka:en)()}),$("#addNewTimePeriod").on("click",function(){La.add()}),$("#deleteAllTimePeriod").on("click",function(){La.clear()}),$("#PC_DateTimePeriod_body").on("click","button[id^=PC_TimePeriod_close_]",function(){var e="PC_TimePeriod_"+p(this.id);La.deleteThisRow(e)}),$("#PC_addLogisticsPlan").on("click",function(){Fa.add()}),$("#PC_addConsumptionPlan").on("click",function(){Ea.add()}),$("#Consumption_add").on("click",function(){Ea.table_add()}),$("#Consumption_reset").on("click",function(){$("#Consumption_select").val(0),Sa(),function(e){var t=0<arguments.length&&void 0!==e?e:"1";$("#Consumption_times").val(t)}()}),$("#Consumption_tbody").on("click","button[id^=Consumption_table_close_row_]",function(){var e="Consumption_table_row_"+p(this.id);Ea._table_deleteThisRow(e)}),$("#PC_startRanking").on("click",function(){var e;""+(e=ka(!0))!="0,0,0,0,0,0,0,0"?0!==(Oa=new Wa(Fa.rankingGetPlans(),e)).allPlan.length?Oa.ranking():E.alert(f.JS.PC_ranking_add_alert):E.alert(f.JS.TargetValue0_alert)}),$("#PlanCombination_current_box").on("blur","input[id^=PC_current_]",function(){Ba.print(Fa.chartGetPlans(),Ea.chartGetPlans()),oa("current",Aa())}),$("#PlanCombination_current_box").on("focus","input[id^=PC_current_]",function(){this.select()}),$("#PlanCombination_demand_card").on("blur","input[id^=PC_target_]",function(){oa("target",xa())}),$("#PlanCombination_demand_card").on("focus","input[id^=PC_target_]",function(){this.select()}),$("#PlanCombination_demand_card").on("blur","input[id^=PC_demand_]",function(){oa("demand",ka())}),$("#PlanCombination_demand_card").on("focus","input[id^=PC_demand_]",function(){this.select()}),$("#PC_calcDemand").on("click",function(){!function(){for(var e=Aa(!0),t=ra(ha(),pa()),a=Ba._calcReAndCoData(e,[],Ea.chartGetPlans(),t),n=[],i=a[0].length-1,r=xa(!0),l=0;l<8;++l){var s=a[l][i];s=Math.max(0,r[l]-s),n.push(s)}wa(n)}()}),$("#PC_saveAll").on("click",function(){E.confirm(f.JS.PC_saveAll_confirm,function(){!function(){for(var e=Fa._plans.length,t=0;t<e;++t)at._saved.push(Fa._plans[t].saved),at._printLastSaved()}()})}),$("#Consumption_select").on("change",function(){Sa(Ve[this.selectedIndex-1])}),$("input[id^=Consumption_]").on("focus",function(){this.select()}),window.onload=function(){if($("#Notransition").remove(),!window.GF_OFFLINE_VERSION){var e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/js-sha1@0.6.0/src/sha1.min.js",document.body.appendChild(e);var t=document.createElement("script");t.src="https://cdn.jsdelivr.net/npm/js-md5@0.7.3/src/md5.min.js",document.body.appendChild(t);var a=document.createElement("script");a.src="https://cdn.jsdelivr.net/npm/lz-string@1.4.4/libs/lz-string.min.js",a.integrity="sha256-nRoO8HoupfqozUr7YKBRgHXmdx40Hl/04OSBzv7e7L8=",a.crossOrigin="anonymous",document.body.appendChild(a);var n=document.createElement("script");n.src="https://cdn.jsdelivr.net/npm/echarts@4.6.0/dist/echarts.min.js",n.integrity="sha256-9TvhGliyfFW2O8SvloAhdFQbfjluHQ+vQ7WWWX5Z7oM=",n.crossOrigin="anonymous",document.body.appendChild(n);var i=document.createElement("script");i.src="https://cdn.jsdelivr.net/npm/es6-promise@4.2.8/dist/es6-promise.auto.min.js",i.integrity="sha256-Xxrdry6fWSKu1j2ALyuK/gHFQ+2Bp76ZrR6f3QXI47Y=",i.crossOrigin="anonymous",document.body.appendChild(i);var r=document.createElement("script");r.src="https://cdn.jsdelivr.net/npm/html2canvas@1.0.0-rc.1/dist/html2canvas.min.js",r.integrity="sha256-uacRffSSMP9qpvNWhVmYLykBv9YKMA1d/VSIN1AmfyQ=",r.crossOrigin="anonymous",document.body.appendChild(r)}sn(),window.GF_OFFLINE_VERSION?setTimeout(loadBackupJS,1):setTimeout(loadBackupJS,6e3)},$("#start_ranking").removeAttr("disabled");